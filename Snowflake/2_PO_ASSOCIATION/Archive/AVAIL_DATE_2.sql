CREATE OR REPLACE TABLE DEV.BUSINESS_OPERATIONS.SEQUENCING_PO_ASSIGN AS
SELECT a.* EXCLUDE AVAIL_DATE
      , CASE WHEN PO_INDICATOR_ASSIGN = 1
             THEN IFF(a.AVAIL_DATE < CURRENT_DATE(), CURRENT_DATE(), AVAIL_DATE)
             WHEN PO_INDICATOR_ASSIGN = 0
             THEN IFF(AVAIL_DATE < CURRENT_DATE() OR a.AVAIL_DATE IS NULL, today90."MIN_SUB_12", AVAIL_DATE)
             ELSE NULL
             END AS "AVAILABILITY_DATE"
FROM DEV.BUSINESS_OPERATIONS.SEQUENCING_PO_ASSIGN a
-- TODAY + 90 DAYS
LEFT JOIN "DEV"."BUSINESS_OPERATIONS"."DIM_FULFILLMENT_CALENDAR" today90 ON today90."RAW_DATE" = DATEADD('day', 90, CURRENT_DATE())